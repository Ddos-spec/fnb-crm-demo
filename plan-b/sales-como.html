<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sales Como Analytics</title>
  <style>
    :root {
      --blue-600: #2563eb;
      --blue-700: #1d4ed8;
      --blue-800: #1e40af;
      --blue-50: #eff6ff;
      --slate-900: #0f172a;
      --slate-700: #334155;
      --slate-600: #475569;
      --slate-100: #f1f5f9;
      --white: #ffffff;
      --green-600: #16a34a;
      --red-600: #dc2626;
      --amber-500: #f59e0b;
      --border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--slate-900);
      background: var(--blue-50);
    }
    .layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }
    /* Sidebar */
    .sidebar {
      background: linear-gradient(180deg, var(--blue-700), var(--blue-800));
      color: var(--white);
      padding: 20px 16px;
    }
    .brand { font-weight: 700; letter-spacing: 0.3px; display: flex; align-items: center; gap: 10px; }
    .brand .logo { width: 28px; height: 28px; border-radius: 6px; background: var(--white); display:flex; align-items:center; justify-content:center; color: var(--blue-700); font-weight: 800; }
    .nav { margin-top: 24px; display: grid; gap: 6px; }
    .nav a { color: #dbeafe; text-decoration: none; padding: 10px 12px; border-radius: 8px; display: flex; align-items: center; gap: 10px; }
    .nav a:hover { background: rgba(255,255,255,0.08); }
    .nav a.active { background: var(--white); color: var(--blue-700); font-weight: 600; }

    /* Header */
    header.topbar {
      background: var(--white);
      border-bottom: 1px solid var(--border);
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* Content */
    .content { padding: 20px; }
    .title { margin: 0 0 4px; font-size: 22px; }
    .muted { color: var(--slate-600); font-size: 14px; }

    /* Filters and actions */
    .toolbar { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; justify-content: space-between; margin: 16px 0 20px; }
    .filters { display: flex; gap: 8px; }
    .chip {
      border: 1px solid var(--border);
      background: var(--white);
      color: var(--slate-700);
      padding: 8px 12px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
    }
    .chip.active { background: var(--blue-600); border-color: var(--blue-600); color: var(--white); }
    .btn {
      background: var(--blue-600);
      color: var(--white);
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn:hover { background: var(--blue-700); }

    /* Cards */
    .cards { display: grid; grid-template-columns: repeat(4, minmax(180px,1fr)); gap: 16px; }
    .card { background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    .card h4 { margin: 0 0 4px; font-size: 14px; color: var(--slate-600); }
    .card .value { font-size: 24px; font-weight: 700; }
    .delta { font-size: 12px; margin-top: 6px; }
    .delta.up { color: var(--green-600); }
    .delta.down { color: var(--red-600); }

    /* Chart */
    .panel { background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    .chart { height: 280px; background: repeating-linear-gradient( to bottom, #f8fafc 0, #f8fafc 22px, transparent 22px, transparent 23px); border-radius: 8px; border: 1px dashed #bfdbfe; display:flex; align-items:center; justify-content:center; color: var(--blue-700); }

    /* Table */
    table { width: 100%; border-collapse: collapse; }
    thead th { text-align: left; font-size: 12px; color: var(--slate-600); border-bottom: 1px solid var(--border); padding: 10px; }
    tbody td { padding: 12px 10px; border-bottom: 1px solid var(--border); font-size: 14px; }
    tbody tr:hover { background: #f8fafc; }

    /* Footer */
    .foot { color: var(--slate-600); font-size: 12px; margin-top: 16px; }

    @media (max-width: 1024px) { .cards { grid-template-columns: repeat(2, 1fr); } .layout { grid-template-columns: 220px 1fr; } }
    @media (max-width: 640px) { .layout { grid-template-columns: 1fr; } .sidebar { position: sticky; top: 0; z-index: 10; } .cards { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand"><span class="logo">Σ</span> FNB CRM</div>
      <nav class="nav">
        <a href="plan-b-dashboard.html">Dashboard</a>
        <a href="sales-como.html" class="active">Sales Como</a>
        <a href="plan-b-reports.html">Reports</a>
        <a href="settings.html">Settings</a>
      </nav>
    </aside>
    <div>
      <header class="topbar">
        <div>
          <h1 class="title">Sales Como</h1>
          <div class="muted">Real-time sales analytics powered by Como API</div>
        </div>
        <button class="btn" id="exportBtn">Export CSV</button>
      </header>

      <main class="content">
        <div class="toolbar">
          <div class="filters">
            <button class="chip active" data-range="today">Today</button>
            <button class="chip" data-range="week">This Week</button>
            <button class="chip" data-range="month">This Month</button>
          </div>
        </div>

        <section class="cards">
          <div class="card">
            <h4>Total Sales</h4>
            <div class="value" id="totalSales">-</div>
            <div class="delta up" id="salesDelta">—</div>
          </div>
          <div class="card">
            <h4>Transactions</h4>
            <div class="value" id="txCount">-</div>
            <div class="delta" id="txDelta">—</div>
          </div>
          <div class="card">
            <h4>Avg. Order Value</h4>
            <div class="value" id="aov">-</div>
            <div class="delta" id="aovDelta">—</div>
          </div>
          <div class="card">
            <h4>Refunds</h4>
            <div class="value" id="refunds">-</div>
            <div class="delta down" id="refundDelta">—</div>
          </div>
        </section>

        <section class="panel" style="margin-top:16px">
          <h3 style="margin:0 0 12px">Sales Trend</h3>
          <div class="chart" id="chart">Sales chart placeholder (connect Como data)</div>
        </section>

        <section class="panel" style="margin-top:16px">
          <h3 style="margin:0 0 12px">Recent Transactions</h3>
          <div style="overflow:auto">
          <table id="txTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Items</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filled dynamically -->
            </tbody>
          </table>
          </div>
          <div class="foot">Showing the latest 20 transactions from Como</div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // Simulated real-time Como API polling. Replace fetchComo with real Como API calls.
    const state = {
      range: 'today',
      timer: null,
      rows: [],
    };

    function fmtCurrency(n){
      return new Intl.NumberFormat(undefined,{style:'currency', currency:'USD'}).format(n);
    }

    function randomItems(){
      const sample = ['Latte','Espresso','Cappuccino','Bagel','Croissant','Sandwich','Salad'];
      const count = Math.ceil(Math.random()*3);
      return Array.from({length:count},()=> sample[Math.floor(Math.random()*sample.length)]).join(', ');
    }

    async function fetchComo(range){
      // TODO: integrate real Como API here.
      // This mock simulates totals + 1-3 new transactions each tick.
      const base = range==='month'? 12000 : range==='week'? 4200 : 600;
      const txs = Math.floor(Math.random()*3)+1;
      const now = new Date();
      const newRows = Array.from({length: txs}).map(()=>{
        const amount = +(Math.random()*25 + 3).toFixed(2);
        return {
          date: now.toLocaleDateString(),
          time: now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
          items: randomItems(),
          amount
        };
      });
      return {
        total: base + state.rows.reduce((s,r)=>s+r.amount,0),
        txCount: state.rows.length,
        aov: state.rows.length ? (state.rows.reduce((s,r)=>s+r.amount,0)/state.rows.length) : 0,
        refunds: Math.floor(state.rows.length*0.02),
        newRows
      };
    }

    function renderStats({total, txCount, aov, refunds}){
      document.getElementById('totalSales').textContent = fmtCurrency(total);
      document.getElementById('txCount').textContent = txCount.toString();
      document.getElementById('aov').textContent = fmtCurrency(aov || 0);
      document.getElementById('refunds').textContent = refunds.toString();
    }

    function renderTable(){
      const tbody = document.querySelector('#txTable tbody');
      tbody.innerHTML = state.rows.slice(-20).reverse().map(r=>`<tr>
        <td>${r.date}</td>
        <td>${r.time}</td>
        <td>${r.items}</td>
        <td>${fmtCurrency(r.amount)}</td>
      </tr>`).join('');
    }

    async function tick(){
      const data = await fetchComo(state.range);
      state.rows.push(...data.newRows);
      renderStats(data);
      renderTable();
      document.getElementById('chart').textContent = `Sales chart placeholder — ${state.rows.length} pts`;
    }

    function setRange(range){
      state.range = range;
      document.querySelectorAll('.chip').forEach(c=>c.classList.toggle('active', c.dataset.range===range));
      state.rows = [];
      renderTable();
      tick();
      clearInterval(state.timer);
      state.timer = setInterval(tick, 4000);
    }

    // Export CSV of currently shown rows
    function exportCSV(){
      const header = ['Date','Time','Items','Amount'];
      const lines = [header.join(',')].concat(
        state.rows.slice(-20).map(r=>[r.date, r.time, '"'+r.items.replace(/"/g,'""')+'"', r.amount].join(','))
      );
      const blob = new Blob([lines.join('\n')], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `sales-como-${state.range}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    document.getElementById('exportBtn').addEventListener('click', exportCSV);
    document.querySelectorAll('.chip').forEach(chip=>{
      chip.addEventListener('click', ()=> setRange(chip.dataset.range));
    });

    // Init
    setRange('today');
  </script>
</body>
</html>
